# 🏗️ АРХИТЕКТУРА: РОДИТЕЛИ ↔ ПОДРОСТКИ
## Философия Jobs: Минимализм, Простота, Гений

> **"Simplicity is the ultimate sophistication"** — Steve Jobs  
> **"Focus means saying no to good ideas"** — Perplexity AI

---

## 🎯 ЦЕЛЬ

**Создать единую платформу с ДВУМЯ отдельными опытами:**
1. 👤 **Подросток** — играет, учится, развивается
2. 👨‍👩‍👧‍👦 **Родитель** — контролирует, поддерживает, учится сам

**КЛЮЧЕВОЙ ПРИНЦИП:** Один аккаунт Telegram → два опыта внутри приложения

---

## 🗝️ КЛЮЧЕВЫЕ РЕШЕНИЯ

### 1️⃣ **ОДИН TELEGRAM ID → ДВЕ РОЛИ**

**ПРОБЛЕМА:** У нас есть `User` с одной ролью, но родитель должен видеть СВОЙ прогресс + прогресс ребёнка.

**РЕШЕНИЕ (Jobs minimalism):**
```typescript
// НЕ создаём отдельные аккаунты
// НЕ создаём сложные связи
// ДОБАВЛЯЕМ одно поле

interface User {
  id: string
  telegramId: number
  role: 'teen' | 'parent'  // ✨ ДОБАВИЛИ 'parent'
  
  // Опциональная связь (если parent)
  children?: string[]  // Array of Telegram IDs
  
  // ... остальное
}
```

**LOGIC:**
```typescript
// Проверка при входе
if (user.role === 'teen') {
  showTeenDashboard()
} else if (user.role === 'parent') {
  showParentDashboard()
}

// Если у parent есть дети
if (user.role === 'parent' && user.children?.length) {
  showChildSelector() // "Чьи уроки смотреть?"
}
```

---

### 2️⃣ **DASHBOARD: ДВА РАЗНЫХ ОПЫТА**

#### 👤 **DASHBOARD ПОДРОСТКА** (существующий)
```
┌─────────────────────────────┐
│  👋 Привет, Алекс!          │
│  🏆 Streak: 7 дней          │
├─────────────────────────────┤
│  📚 Модуль "Личные границы" │
│     ████████░░ 80%          │
│                             │
│  ✅ Урок 1 ✓                │
│  ✅ Урок 2 ✓                │
│  🔄 Урок 3 (текущий)        │
│  🔒 Урок 4 (заблокирован)   │
├─────────────────────────────┤
│  🎯 Рекомендация дня        │
│     "Потренируйся говорить  │
│      НЕТ друзьям"           │
├─────────────────────────────┤
│  📊 Badges: 5/12            │
│  XP: 450 / Level 3          │
└─────────────────────────────┘
```

#### 👨‍👩‍👧‍👦 **DASHBOARD РОДИТЕЛЯ** (новый)
```
┌─────────────────────────────┐
│  👋 Привет, Мария!          │
│  👨‍👦 Алекс (14 лет)         │
├─────────────────────────────┤
│  📊 ПРОГРЕСС РЕБЁНКА        │
│  ⏰ Эта неделя              │
│     ████████░░ 80%          │
│                             │
│  ✅ Урок 1 завершён         │
│  ✅ Урок 2 завершён         │
│  🔄 Урок 3 в процессе       │
├─────────────────────────────┤
│  📈 СТАТИСТИКА              │
│  • Посещаемость: 90%        │
│  • Средний балл: 85%        │
│  • Streak: 7 дней           │
├─────────────────────────────┤
│  📚 МОЁ ОБУЧЕНИЕ            │
│    5 уроков для родителей   │
│    ████░░░░░░ 40%           │
└─────────────────────────────┘
```

**Jobs принцип:** Два опыта, один код. Переиспользуем компоненты.

---

### 3️⃣ **МОДУЛИ: РАЗДЕЛЕНИЕ ПО РОЛЯМ**

#### 📚 **ДЛЯ ПОДРОСТКОВ** (9 уроков)
```
Модуль: "Личные границы для подростков"
- Урок 1: Что такое границы? (10 мин)
- Урок 2: 5 кругов близости (15 мин)
- Урок 3: Когда говорю НЕТ (10 мин)
- ... уроки 4-9
```

#### 📚 **ДЛЯ РОДИТЕЛЕЙ** (5 уроков)
```
Модуль: "Личные границы для родителей"
- Урок 1: Как поддержать подростка? (20 мин)
- Урок 2: Границы в семье (20 мин)
- Урок 3: Когда вмешиваться? (20 мин)
- Урок 4: Развиваем автономию (20 мин)
- Урок 5: Поддерживаем практикой (20 мин)
```

**LOGIC:**
```typescript
// В UniversalModuleViewer.tsx
function UniversalModuleViewer({ moduleId, userRole }) {
  if (userRole === 'teen') {
    module = boundariesModule // 9 уроков
  } else if (userRole === 'parent') {
    module = boundariesParentModule // 5 уроков
  }
  
  // Остальное одинаково
  return <LessonViewer lesson={module.lessons[currentLesson]} />
}
```

---

### 4️⃣ **СВЯЗЬ РОДИТЕЛЬ ↔ РЕБЁНОК**

#### 🔗 **Регистрация семейной связи:**

**СЦЕНАРИЙ 1: Родитель регистрируется после ребёнка**
```
1. Родитель открывает приложение
2. Бот спрашивает: "У тебя уже есть ребёнок в DA Teens?"
3. Если ДА: ввести Telegram ID ребёнка или username
4. Проверка в базе → связь создана
```

**СЦЕНАРИЙ 2: Ребёнок приглашает родителя**
```
1. Ребёнок заходит в настройки
2. Кнопка: "Пригласить родителя"
3. Генерируется уникальная ссылка
4. Родитель переходит → связь создана
```

**Код:**
```typescript
// При регистрации родителя
async function linkParentToChild(parentId: string, childId: string) {
  // 1. Проверить, что childId существует
  const child = await db.users.findOne({ telegramId: childId })
  if (!child) throw new Error('Ребёнок не найден')
  
  // 2. Обновить родителя
  await db.users.updateOne(
    { telegramId: parentId },
    { $push: { children: childId } }
  )
  
  // 3. Обновить ребёнка (опционально, для двухсторонней связи)
  await db.users.updateOne(
    { telegramId: childId },
    { $set: { parentId: parentId } }
  )
}
```

---

### 5️⃣ **ПРАВО ДОСТУПА РОДИТЕЛЯ**

**ЧТО РОДИТЕЛЬ ВИДИТ:**
- ✅ Прогресс по урокам (завершён/в процессе/заблокирован)
- ✅ Посещаемость вебинаров (был/не был)
- ✅ XP и уровень
- ✅ Badges (какие получил)
- ✅ Streak (дней подряд)
- ✅ Общий процент завершения модуля

**ЧТО РОДИТЕЛЬ НЕ ВИДИТ:**
- ❌ Переписка в группе
- ❌ Личные заметки ребёнка (check-ins с комментариями)
- ❌ Домашние задания (содержание)
- ❌ Детали ответов на квизы

**Jobs принцип:** Прозрачность без нарушения приватности.

---

## 🏗️ СТРУКТУРА КОДА (FSD)

### 📁 НОВЫЕ ФАЙЛЫ

```
src/
├── entities/
│   └── user/
│       └── model/
│           ├── types.ts (добавить role + children)
│           └── api.ts (linkParentToChild)
│
├── features/
│   ├── parent-dashboard/
│   │   ├── ui/
│   │   │   ├── ParentDashboard.tsx ✨ НОВЫЙ
│   │   │   ├── ChildProgressCard.tsx ✨ НОВЫЙ
│   │   │   └── ParentLessonViewer.tsx ✨ НОВЫЙ
│   │   └── model/
│   │       └── parentDashboard.ts
│   │
│   └── family-linking/
│       ├── ui/
│       │   ├── ChildInviteFlow.tsx ✨ НОВЫЙ
│       │   └── ParentLinkFlow.tsx ✨ НОВЫЙ
│       └── model/
│           └── linking.ts
│
├── widgets/
│   └── role-selector/
│       └── ui/
│           └── RoleBasedLayout.tsx ✨ НОВЫЙ
│
└── pages/
    ├── teen/
    │   └── Dashboard.tsx (существующий)
    └── parent/
        └── Dashboard.tsx ✨ НОВЫЙ
```

---

## 🎯 ПОРЯДОК РЕАЛИЗАЦИИ

### Phase 1: Типы и модель (30 мин)
- [ ] Добавить `role: 'parent'` в `User` тип
- [ ] Добавить `children?: string[]` в `User` тип
- [ ] Создать `ParentDashboard.tsx` (заглушка)

### Phase 2: Переключение ролей (1 час)
- [ ] Создать `RoleBasedLayout.tsx`
- [ ] Логика: `if (role === 'teen') showTeenDashboard() else showParentDashboard()`
- [ ] Тест: переключение между ролями

### Phase 3: Parent Dashboard (2 часа)
- [ ] UI: список детей
- [ ] UI: прогресс ребёнка
- [ ] UI: статистика (посещаемость, streak, XP)

### Phase 4: Parent Lessons (2 часа)
- [ ] Создать `ParentLessonViewer.tsx`
- [ ] Интегрировать `boundariesParentModule.ts`
- [ ] Тест: родитель проходит уроки

### Phase 5: Связь Родитель ↔ Ребёнок (1 час)
- [ ] UI: приглашение ребёнка
- [ ] Логика: `linkParentToChild()`
- [ ] Тест: подключение и отображение

### Phase 6: Тестирование (1 час)
- [ ] Локально: все сценарии
- [ ] Production: запуск beta с реальными пользователями

**ИТОГО: 7.5 часов разработки**

---

## 🔐 БЕЗОПАСНОСТЬ

### Валидация связей
```typescript
// Родитель может видеть только СВОИХ детей
async function getChildProgress(parentId: string, childId: string) {
  const parent = await db.users.findOne({ telegramId: parentId })
  
  if (!parent.children?.includes(childId)) {
    throw new Error('Доступ запрещён')
  }
  
  return await db.progress.findOne({ userId: childId })
}
```

### Приватность
- Check-in данные с комментариями → НЕ показываем родителям
- Переписка в группе → НЕ показываем родителям
- Содержание домашних заданий → НЕ показываем родителям
- Только агрегированная статистика

---

## 📊 МЕТРИКИ УСПЕХА

### Для подростков
- Retention: 70%+
- Engagement: 5+ уроков/неделю
- Completion: 80%+ модулей

### Для родителей
- Registration: 40%+ родителей регистрируются
- Engagement: 3+ родительских урока/неделю
- Satisfaction: NPS 50+ (опросы после завершения)

---

## 🚀 ДЕПЛОЙ

### Week 1: Базовая инфраструктура
- Типы, модели, заглушки

### Week 2: Родительский dashboard
- Полный UI + связь с детьми

### Week 3: Родительские уроки
- Интеграция 5 уроков от Кати

### Week 4: Beta launch
- Запуск с реальными пользователями
- Сбор feedback
- Итерация

---

**Последнее обновление:** 1 ноября 2025  
**Статус:** 🟡 Готово к реализации  
**Приоритет:** 🔴 Высокий (ключевая фича)

